# 购买实例<a name="ZH-CN_TOPIC_0169047446"></a>

## 操作场景<a name="section66578044"></a>

目前，DMS提供Kafka专享版实例的服务，Kafka专享版实例采用物理隔离的方式部署，租户独占Kafka实例。支持用户自定义规格和自定义特性，您可以根据业务需要定制相应计算能力和存储空间的Kafka实例。

## 前提条件<a name="section62331491"></a>

Kafka专享版实例运行于虚拟私有云，创建实例前，需保证有可用的虚拟私有云，并且已配置好安全组与子网。

## 操作步骤<a name="section1474721314405"></a>

1.  登录管理控制台。
2.  在管理控制台左上角单击![](figures/icon-region.png)，选择区域。

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >此处请选择与您的应用服务相同的区域。  

3.  单击页面上方的“服务列表”，选择“应用服务 \> 分布式消息服务 Kafka”，进入分布式消息服务Kafka专享版页面。
4.  单击页面右上方的“购买实例”。

    每个项目默认最多可以创建100个Kafka专享版实例，如果您想创建更多实例，请联系客服申请增加配额。

5.  选择付费方式。
6.  在“区域”下拉列表中，选择靠近您应用程序的区域，可降低网络延时、提高访问速度。
7.  在“可用区”区域，您根据实际情况选择。
8.  设置“实例名称”和“描述”。
9.  设置企业项目。

    表示实例所属的企业项目。单击下拉框可选择一个企业项目。

10. 设置实例信息。
    1.  “版本”，表示kafka的版本号，当前仅支持1.1.0，保持默认值即可。
    2.  在“基准带宽”区域，您可以根据业务流量选择带宽。

        VPC内访问实例时，能稳定达到的带宽，单位为MB/s，支持100MB/s、300MB/s、600MB/s、1200MB/s。

        为了保证业务的稳定性，当连接或者分区topic较多时，建议优先选择较大的带宽。

    3.  “分区上限”参数保持默认值即可。

        分区上限，指Kafka专享版实例可创建的最大分区总数。当所有topic的总分区数大于此值时创建topic失败。

        -   基准带宽为100MB/s时，分区上限为300。
        -   基准带宽为300MB/s时，分区上限为900。
        -   基准带宽为600MB/s时，分区上限为1800。
        -   基准带宽为1200MB/s时，分区上限为1800。

    4.  在“存储空间”区域，您根据实际需要选择存储Kafka数据的总磁盘大小。

        如果磁盘可用空间小于5%，将只能消费消息，不能生产消息。消息在老化后不再占用磁盘空间。

        创建实例时会进行磁盘格式化，磁盘格式化会导致实际可用磁盘为总磁盘的93%\~95%。

        -   基准带宽为100MB/s时，存储空间取值范围：600GB \~ 90000GB。
        -   基准带宽为300MB/s时，存储空间取值范围：1200GB \~ 90000GB。
        -   基准带宽为600MB/s时，存储空间取值范围：2400GB \~ 90000GB。
        -   基准带宽为1200MB/s时，存储空间取值范围：4800GB \~ 90000GB。

        >![](public_sys-resources/icon-note.gif) **说明：**   
        >-   高IO + 100MB/sB带宽：假设平均消息体大小为1KB，则高吞吐场景可达10万条/秒，同步复制场景可达6万条/秒。  
        >-   高IO + 300MB/s带宽 :  假设平均每条消息1KB，则高吞吐场景下可达30万条/秒，同步复制场景可达15万条/秒。  
        >-   超高IO + 100MB/s带宽：假设平均消息体大小为1KB，则高吞吐场景可达10万条/秒，同步复制场景可达8万条/秒。  
        >-   超高IO + 300MB/s带宽：假设平均每条消息1KB，则高吞吐场景可达30万条/秒，同步复制场景可达20万条/秒。  
        >-   超高IO + 600MB/s带宽：假设平均每条消息1KB，则高吞吐场景可达60万条/秒，同步复制场景可达30万条/秒。  
        >-   超高IO + 1200MB/s带宽：假设平均每条消息1KB，则高吞吐场景可达120万条/秒，同步复制场景可达40万条/秒。  

    5.  在“虚拟私有云”下拉列表，选择已经创建好的虚拟私有云。
        -   虚拟私有云可以为您的Kafka专享实例构建隔离的、能自主配置和管理的虚拟网络环境。
        -   您可单击右侧的“查看虚拟私有云”，系统跳转到虚拟私有云界面，选择相应的虚拟私有云，可以查看安全组的出方向规则和入方向规则。

    6.  在“子网”下拉列表，选择已经创建好的子网。

        您可以单击右侧的“查看子网”，系统跳转到网络控制台页面，查看对应子网的私有IP地址等信息。

    7.  在“安全组”下拉列表，可以选择已经创建好的安全组。

        安全组是一组对弹性云服务器的访问规则的集合，为同一个VPC内具有相同安全保护需求并相互信任的弹性云服务器提供访问策略。

        您可以单击右侧的“管理安全组”，系统换到网络控制台的安全组页面，查看或创建安全组。

        **图 1**  购买Kafka专享版实例<a name="fig16974145414282"></a>  
        ![](figures/购买Kafka专享版实例.png "购买Kafka专享版实例")

11. 设置“容量阈值策略”。

    容量阈值策略，是指磁盘使用达到容量阈值后的消息处理策略，容量阈值默认为95%。

    -   生产受限：无法继续生产消息，但可以继续消费消息。
    -   自动删除：可以正常生产和消费消息，但是会删除最早的10%的消息，以保证磁盘容量充足。

12. 设置登录Kafka Manager的用户名和密码。
13. 设置实例购买时长。

    当选择了“包年/包月”付费模式时，页面才显示“购买时长”参数，您需要根据业务需要选择。

14. 单击“更多配置”，设置更多相关信息。
    1.  设置“公网访问”。

        “公网访问”默认为关闭状态，您可以选择是否开启。您可以创建3个开启公网访问的Kafka实例。如果您想创建更多公网访问实例，请联系客服申请增加配额。

        当您选择了开启，你还需要设置公网带宽。

    2.  设置“Kafka SASL\_SSL”。

        您可以选择是否打开客户端连接Kafka专享版实例时SSL认证的开关。Kafka SASL\_SSL开关不支持创建实例后修改，请慎重选择，如果创建后需要修改，需要重新创建实例。

        开启Kafka SASL\_SSL，则数据加密传输，安全性更高。

        当您选择了开启，您还需要设置连接Kafka专享版实例的用户名和密码。

        Kafka专享版实例密码复杂度要求：

        -   密码不能为空。
        -   输入长度为8到32位的字符串。
        -   必须包含如下四种字符中的三种组合：
            -   小写字母
            -   大写字母
            -   数字
            -   特殊字符包括（\`\~!@\#$%^&\*\(\)-\_=+\\|\[\{\}\]:'",<.\>/?）
            -   不能以-开头。

    3.  在“转储”参数，选择是否开启转储开关。

        通过开启转储将数据转储至OBS桶，实现数据的备份。

        >![](public_sys-resources/icon-note.gif) **说明：**   
        >-   消息包含消息属性（由属性名及属性值组成，以K-V的形式体现）时，属性名key不支持转储，属性值value支持转储。  
        >-   当前开启转储后，暂不支持关闭转储。  

    4.  设置“kafka自动创建Topic”。

        您可以选择是否开启kafka自动创建Topic的开关。

        当您选择开启，表示生产或消费一个未创建的Topic时，会自动创建一个包含3个分区和3个副本的Topic。

    5.  设置实例维护时间窗。

        设置运维人员可用对该实例的节点进行维护操作时间。

        维护期间，业务可以正常使用，可能会发生闪断。维护操作通常几个月一次。

    6.  设置“标签”。

        标签用于标识云资源，当您拥有相同类型的许多云资源时，可以使用标签按各种维度（例如用途、所有者或环境）对云资源进行分类。

        -   如果您已经预定义了标签，在“标签键”和“标签值”中选择已经定义的标签键值对。另外，您可以单击右侧的“查看预定义标签”，系统会跳转到标签管理服务页面，查看已经预定义的标签，或者创建新的标签。
        -   您也可以直接在“标签键”和“标签值”中设置标签。

        当前每个Kafka实例最多支持设置20个不同标签，标签的命名规格，请参考[管理标签](管理标签.md)章节。

15. 填写完上述信息后，单击页面右侧的“立即购买”，进入“规格确认”页面。
16. 确认实例信息无误后，提交请求。
17. Kafka专享版实例创建成功后，用户可以单击“返回Kafka专享版”，查看并管理自己的Kafka专享版实例。
    1.  创建Kafka专享版实例大约需要3到15分钟。
    2.  Kafka专享版实例创建成功后，默认“状态”为“运行中”。
    3.  如果创建Kafka专享版实例失败，可参考[删除实例](删除实例.md)，删除创建失败的Kafka专享版实例，然后重新申请。如果重新申请仍然失败，请联系客服。


